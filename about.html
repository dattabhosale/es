<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>About - LeapReplica</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">LeapReplica</a>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
      <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    </div>
  </header>

  <main>
    <section class="container">
      <h1>About LeapReplica</h1>
      <p>LeapReplica is a fictional electric vehicle company created for demonstration purposes. We focus on sustainable mobility, safety and smart vehicle software.</p>
      <h2>Mission</h2>
      <p>To accelerate the transition to sustainable transportation through thoughtful design and engineering.</p>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">© 2025 LeapReplica</div>
  </footer>

  <script src="js/main.js"></script>
  <script type="text/javascript">
  (function () {
  "use strict";
  // ============================================================================
  // CONSTANTS
  // ============================================================================
  const CONFIG = {
    ELEMENT_IDS: {
      CHAT_BUTTON: "custom-chat-button",
      NOTIFICATION_BADGE: "chat-notification-badge",
      PROACTIVE_BUBBLE: "chat-proactive-bubble",
      STYLES: "custom-chat-styles",
    },
    COLORS: {
      MAIN: "#2d5016", // Pantone 2427C
      HIGHLIGHT: "#00a145", // R0 G145 B0
      NOTIFICATION: "#e74c3c", // Red badge
      WHITE: "#ffffff",
    },
    TIMING: {
      PROACTIVE_DELAY: 5000, // Show proactive message after 5 seconds
      POLLING_INTERVAL: 200,
      MAX_POLLING_ATTEMPTS: 50,
    },
    LOCALIZATION: {
      PROACTIVE_MESSAGES: {
        it: "Necesitas ayuda?",
        es: "Necesitas ayuda?",
        fr: "Besoin d'aide?",
        de: "Brauchst du Hilfe?",
        uk: "Need help?",
        us: "Need help?",
        en: "Need help?",
      },
    },
  };
  // ============================================================================
  // STATE
  // ============================================================================
  const state = {
    embeddedServiceInstance: null,
    countryCode: getCountryCodeFromPath(),
    unreadCount: 0,
    isProactiveVisible: false,
    isChatOpen: false,
    proactiveTimer: null,
    standardButtonPosition: null,
  };
  // ============================================================================
  // UTILITY FUNCTIONS
  // ============================================================================
  /**
   * Extract country code from URL pathname
   */
  function getCountryCodeFromPath() {
    const pathParts = window.location.pathname
      .split("/")
      .filter(function (part) {
        return part.length > 0;
      });
    return pathParts.length > 0 ? pathParts[0].toLowerCase() : "en";
  }
  /**
   * Apply multiple styles to an element
   */
  function applyStyles(element, styles) {
    Object.keys(styles).forEach(function (key) {
      element.style[key] = styles[key];
    });
  }
  /**
   * Get standard Salesforce button position
   */
  function getStandardButtonPosition() {
    // Try to find the standard Salesforce chat button
    const standardButton = document.querySelector(
      '.embeddedMessagingConversationButton, [id*="embeddedMessaging"]'
    );
    if (standardButton) {
      const rect = standardButton.getBoundingClientRect();
      return {
        right: window.innerWidth - rect.right + "px",
        bottom: window.innerHeight - rect.bottom + "px",
      };
    }
    // Fallback to default position
    return {
      right: "20px",
      bottom: "20px",
    };
  }
  /**
   * Inject CSS styles
   */
  function injectStyles() {
    if (document.getElementById(CONFIG.ELEMENT_IDS.STYLES)) return;
    const style = document.createElement("style");
    style.id = CONFIG.ELEMENT_IDS.STYLES;
    style.textContent = `
      @keyframes pulse {
        0%, 100% { 
          transform: scale(1); 
          box-shadow: 0 4px 12px rgba(0,0,0,0.2), 0 0 20px rgba(0, 161, 69, 0.3); 
        }
        50% { 
          transform: scale(1.05); 
          box-shadow: 0 6px 16px rgba(0,0,0,0.25), 0 0 30px rgba(0, 161, 69, 0.5); 
        }
      }
      
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      
      @keyframes badgePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
      
      #${CONFIG.ELEMENT_IDS.CHAT_BUTTON} {
        animation: pulse 2s ease-in-out infinite;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      #${CONFIG.ELEMENT_IDS.CHAT_BUTTON}:hover {
        transform: scale(1.1) !important;
        box-shadow: 0 6px 16px rgba(0,0,0,0.3), 0 0 40px rgba(0, 161, 69, 0.6) !important;
      }
      
      #${CONFIG.ELEMENT_IDS.PROACTIVE_BUBBLE} {
        animation: slideIn 0.4s ease-out;
      }
      
      #${CONFIG.ELEMENT_IDS.NOTIFICATION_BADGE} {
        animation: badgePulse 1s ease-in-out infinite;
      }
    `;
    document.head.appendChild(style);
  }
  // ============================================================================
  // BUTTON CREATION
  // ============================================================================
  /**
   * Create chat icon SVG
   */
  function createChatIcon() {
    const iconContainer = document.createElement("div");
    iconContainer.innerHTML = `
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 2H4C2.9 2 2.01 2.9 2.01 4L2 22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" 
              fill="white" opacity="0.95"/>
        <circle cx="7" cy="10" r="1.5" fill="${CONFIG.COLORS.HIGHLIGHT}">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0s"/>
        </circle>
        <circle cx="12" cy="10" r="1.5" fill="${CONFIG.COLORS.HIGHLIGHT}">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0.2s"/>
        </circle>
        <circle cx="17" cy="10" r="1.5" fill="${CONFIG.COLORS.HIGHLIGHT}">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0.4s"/>
        </circle>
      </svg>
    `;
    applyStyles(iconContainer, {
      width: "100%",
      height: "100%",
      display: "flex",
      alignItems: "center",
      justifyContent: "center",
    });
    return iconContainer;
  }
  /**
   * Create notification badge
   */
  function createNotificationBadge() {
    const badge = document.createElement("div");
    badge.id = CONFIG.ELEMENT_IDS.NOTIFICATION_BADGE;
    applyStyles(badge, {
      position: "absolute",
      top: "-5px",
      right: "-5px",
      backgroundColor: CONFIG.COLORS.NOTIFICATION,
      color: CONFIG.COLORS.WHITE,
      borderRadius: "50%",
      width: "24px",
      height: "24px",
      display: "none",
      alignItems: "center",
      justifyContent: "center",
      fontSize: "12px",
      fontWeight: "700",
      fontFamily: "'Arial', sans-serif",
      border: "2px solid white",
      boxShadow: "0 2px 8px rgba(0,0,0,0.3)",
      zIndex: "1",
    });
    return badge;
  }
  /**
   * Create proactive message bubble
   */
  function createProactiveBubble() {
    const bubble = document.createElement("div");
    bubble.id = CONFIG.ELEMENT_IDS.PROACTIVE_BUBBLE;
    const message =
      CONFIG.LOCALIZATION.PROACTIVE_MESSAGES[state.countryCode] ||
      CONFIG.LOCALIZATION.PROACTIVE_MESSAGES["en"];
    bubble.textContent = message;
    applyStyles(bubble, {
      position: "absolute",
      right: "80px",
      top: "50%",
      transform: "translateY(-50%)",
      backgroundColor: CONFIG.COLORS.WHITE,
      color: CONFIG.COLORS.MAIN,
      padding: "12px 18px",
      borderRadius: "20px",
      fontSize: "14px",
      fontWeight: "600",
      fontFamily: "'Montserrat', 'Arial', sans-serif",
      boxShadow: "0 4px 12px rgba(0,0,0,0.15)",
      whiteSpace: "nowrap",
      display: "none",
      zIndex: "0",
    });
    // Add arrow pointing to button
    const arrow = document.createElement("div");
    applyStyles(arrow, {
      position: "absolute",
      right: "-8px",
      top: "50%",
      transform: "translateY(-50%)",
      width: "0",
      height: "0",
      borderTop: "8px solid transparent",
      borderBottom: "8px solid transparent",
      borderLeft: "8px solid " + CONFIG.COLORS.WHITE,
    });
    bubble.appendChild(arrow);
    return bubble;
  }
  /**
   * Create the main chat button
   */
  function createChatButton() {
    const container = document.createElement("div");
    applyStyles(container, {
      position: "fixed",
      zIndex: "99999",
      display: "flex",
      alignItems: "center",
    });
    const btn = document.createElement("button");
    btn.id = CONFIG.ELEMENT_IDS.CHAT_BUTTON;
    btn.setAttribute("aria-label", "Open chat");
    applyStyles(btn, {
      position: "relative",
      width: "60px",
      height: "60px",
      borderRadius: "50%",
      border: "none",
      cursor: "pointer",
      boxShadow: "0 4px 12px rgba(0,0,0,0.2), 0 0 20px rgba(0, 161, 69, 0.3)",
      background:
        "linear-gradient(135deg, " +
        CONFIG.COLORS.HIGHLIGHT +
        " 0%, #00c853 100%)",
      color: CONFIG.COLORS.WHITE,
      display: "flex",
      alignItems: "center",
      justifyContent: "center",
      padding: "0",
      overflow: "visible",
      fontFamily: "'Arial', sans-serif",
    });
    // Add chat icon
    const chatIcon = createChatIcon();
    btn.appendChild(chatIcon);
    // Add notification badge
    const badge = createNotificationBadge();
    btn.appendChild(badge);
    // Add proactive bubble
    const bubble = createProactiveBubble();
    container.appendChild(bubble);
    container.appendChild(btn);
    // Event listeners
    btn.addEventListener("click", function () {
      launchChat();
    });
    btn.addEventListener("mouseenter", function () {
      btn.style.transform = "scale(1.1)";
    });
    btn.addEventListener("mouseleave", function () {
      btn.style.transform = "scale(1)";
    });
    return container;
  }
  // ============================================================================
  // CHAT FUNCTIONALITY
  // ============================================================================
  /**
   * Launch the chat window
   */
  function launchChat() {
    if (
      !state.embeddedServiceInstance ||
      !state.embeddedServiceInstance.utilAPI ||
      typeof state.embeddedServiceInstance.utilAPI.launchChat !== "function"
    ) {
      console.warn("launchChat() not available");
      return;
    }
    state.isChatOpen = true;
    hideProactiveBubble();
    hideNotificationBadge();
    console.log("Launching chat...");
    const result = state.embeddedServiceInstance.utilAPI.launchChat();
    if (result && typeof result.then === "function") {
      result
        .then(function () {
          console.log("Chat launched successfully");
        })
        .catch(function (error) {
          console.error("Error launching chat:", error);
        });
    }
  }
  /**
   * Hide standard Salesforce button
   */
  function hideStandardButton(es) {
    if (!es || !es.utilAPI || typeof es.utilAPI.hideChatButton !== "function") {
      return;
    }
    try {
      es.utilAPI.hideChatButton();
      console.log("Standard chat button hidden");
    } catch (error) {
      console.warn("Error hiding standard chat button:", error);
    }
  }
  // ============================================================================
  // NOTIFICATION SYSTEM
  // ============================================================================
  /**
   * Update notification badge
   */
  function updateNotificationBadge(count) {
    const badge = document.getElementById(
      CONFIG.ELEMENT_IDS.NOTIFICATION_BADGE
    );
    if (!badge) return;
    state.unreadCount = count;
    if (count > 0 && !state.isChatOpen) {
      badge.textContent = count > 9 ? "9+" : count.toString();
      badge.style.display = "flex";
      console.log("Notification badge shown with count:", count);
    } else {
      badge.style.display = "none";
    }
  }
  /**
   * Hide notification badge
   */
  function hideNotificationBadge() {
    const badge = document.getElementById(
      CONFIG.ELEMENT_IDS.NOTIFICATION_BADGE
    );
    if (badge) {
      badge.style.display = "none";
      state.unreadCount = 0;
    }
  }
  /**
   * Listen for message events from Salesforce
   */
  function setupMessageListener() {
    // Listen for Salesforce messaging events
    window.addEventListener(
      "onEmbeddedMessagingMessageReceived",
      function (event) {
        console.log("Message received event:", event);
        // Only show notification if chat is minimized
        if (!state.isChatOpen) {
          state.unreadCount++;
          updateNotificationBadge(state.unreadCount);
        }
      }
    );
    // Alternative: Poll for unread messages if event not available
    // This is a fallback mechanism
    if (
      state.embeddedServiceInstance &&
      state.embeddedServiceInstance.utilAPI
    ) {
      // Check if there's an API to get unread count
      // This depends on Salesforce's API availability
    }
  }
  // ============================================================================
  // PROACTIVE ENGAGEMENT
  // ============================================================================
  /**
   * Show proactive message bubble
   */
  function showProactiveBubble() {
    const bubble = document.getElementById(CONFIG.ELEMENT_IDS.PROACTIVE_BUBBLE);
    if (bubble && !state.isProactiveVisible && !state.isChatOpen) {
      bubble.style.display = "block";
      state.isProactiveVisible = true;
      console.log("Proactive message shown");
    }
  }
  /**
   * Hide proactive message bubble
   */
  function hideProactiveBubble() {
    const bubble = document.getElementById(CONFIG.ELEMENT_IDS.PROACTIVE_BUBBLE);
    if (bubble) {
      bubble.style.display = "none";
      state.isProactiveVisible = false;
    }
  }
  /**
   * Start proactive engagement timer
   */
  function startProactiveTimer() {
    // Clear existing timer
    if (state.proactiveTimer) {
      clearTimeout(state.proactiveTimer);
    }
    // Set new timer
    state.proactiveTimer = setTimeout(function () {
      showProactiveBubble();
    }, CONFIG.TIMING.PROACTIVE_DELAY);
  }
  /**
   * Reset proactive timer on user activity
   */
  function resetProactiveTimer() {
    hideProactiveBubble();
    startProactiveTimer();
  }
  // ============================================================================
  // BUTTON VISIBILITY MANAGEMENT
  // ============================================================================
  /**
   * Show custom chat button
   */
  function showCustomButton(es) {
    if (!es || !es.utilAPI) {
      console.warn("utilAPI not available");
      return;
    }
    // Check if button already exists
    const existing = document.getElementById(CONFIG.ELEMENT_IDS.CHAT_BUTTON);
    if (existing) {
      existing.parentElement.style.display = "flex";
      hideStandardButton(es);
      console.log("Custom button shown again");
      return;
    }
    // Inject styles
    injectStyles();
    // Get position from standard button
    state.standardButtonPosition = getStandardButtonPosition();
    // Create and append button
    const chatButton = createChatButton();
    applyStyles(chatButton, state.standardButtonPosition);
    document.body.appendChild(chatButton);
    // Store instance and hide standard button
    state.embeddedServiceInstance = es;
    hideStandardButton(es);
    // Setup message listener
    setupMessageListener();
    // Start proactive timer
    startProactiveTimer();
    // Reset timer on user activity
    document.addEventListener("mousemove", resetProactiveTimer);
    document.addEventListener("keydown", resetProactiveTimer);
    document.addEventListener("scroll", resetProactiveTimer);
    console.log(
      "Custom chat button created at position:",
      state.standardButtonPosition
    );
  }
  /**
   * Hide custom chat button
   */
  function hideCustomButton() {
    const btn = document.getElementById(CONFIG.ELEMENT_IDS.CHAT_BUTTON);
    if (btn && btn.parentElement) {
      btn.parentElement.style.display = "none";
      console.log("Custom button hidden");
    }
  }
  // ============================================================================
  // EVENT HANDLERS
  // ============================================================================
  /**
   * Handle button created event
   */
  function handleButtonCreated() {
    console.log("onEmbeddedMessagingButtonCreated fired");
    const es = window.embeddedservice_bootstrap;
    if (es) {
      showCustomButton(es);
    }
  }
  /**
   * Handle window maximized event
   */
  function handleWindowMaximized() {
    console.log("onEmbeddedMessagingWindowMaximized fired");
    state.isChatOpen = true;
    hideCustomButton();
    hideProactiveBubble();
    hideNotificationBadge();
  }
  /**
   * Handle window minimized event
   */
  function handleWindowMinimized() {
    console.log("onEmbeddedMessagingWindowMinimized fired");
    state.isChatOpen = false;
    const es = window.embeddedservice_bootstrap;
    if (es) {
      hideStandardButton(es);
      showCustomButton(es);
      // Don't show notification badge immediately
      // It will only appear when new messages arrive
      // Restart proactive timer
      startProactiveTimer();
    }
  }
  // ============================================================================
  // INITIALIZATION
  // ============================================================================
  /**
   * Poll for embedded service availability
   */
  function waitForEmbeddedService() {
    let attempts = 0;
    (function check() {
      attempts++;
      const es = window.embeddedservice_bootstrap;
      if (es && es.utilAPI) {
        console.log("utilAPI ready");
        showCustomButton(es);
        return;
      }
      if (attempts >= CONFIG.TIMING.MAX_POLLING_ATTEMPTS) {
        console.warn("utilAPI not found after " + attempts + " attempts");
        return;
      }
      setTimeout(check, CONFIG.TIMING.POLLING_INTERVAL);
    })();
  }
  /**
   * Initialize the custom chat button
   */
  function init() {
    console.log(
      "Initializing custom chat button for country:",
      state.countryCode
    );
    // Register event listeners
    window.addEventListener(
      "onEmbeddedMessagingButtonCreated",
      handleButtonCreated
    );
    window.addEventListener(
      "onEmbeddedMessagingWindowMaximized",
      handleWindowMaximized
    );
    window.addEventListener(
      "onEmbeddedMessagingWindowMinimized",
      handleWindowMinimized
    );
    // Start polling for embedded service
    if (
      document.readyState === "complete" ||
      document.readyState === "interactive"
    ) {
      waitForEmbeddedService();
    } else {
      window.addEventListener("DOMContentLoaded", waitForEmbeddedService);
    }
  }
  // Start initialization
  init();
})();

></script>
</body>
</html>
