<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>About - LeapReplica</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">LeapReplica</a>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
      <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    </div>
  </header>

  <main>
    <section class="container">
      <h1>About LeapReplica</h1>
      <p>LeapReplica is a fictional electric vehicle company created for demonstration purposes. We focus on sustainable mobility, safety and smart vehicle software.</p>
      <h2>Mission</h2>
      <p>To accelerate the transition to sustainable transportation through thoughtful design and engineering.</p>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">© 2025 LeapReplica</div>
  </footer>

  <script src="js/main.js"></script>
<script type="text/javascript">
  /**
   * Initialize Salesforce Embedded Messaging with country-specific settings
   */
  function initEmbeddedMessaging() {
    try {
      const countryCode = getCountryCodeFromPath();
      const countryInfo = getCountryInfo(countryCode);
      // Configure embedded service settings
      embeddedservice_bootstrap.settings.language = countryInfo.language;
      embeddedservice_bootstrap.settings.shouldOpenLinksInSameTab = true;
      embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
      embeddedservice_bootstrap.settings.chatButtonPosition = "100px, 30px";
      console.log(
        "Detected country code:",
        countryCode,
        "| Setting language to:",
        countryInfo.language
      );
      // Set prechat fields when ready
      window.addEventListener("onEmbeddedMessagingReady", function () {
        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
          Country: countryInfo.name,
          Language: countryInfo.language,
          CountryCode: countryInfo.code,
        });
      });
      // Initialize embedded service
      embeddedservice_bootstrap.init(
        "00DMA000003XnGM",
        "LPM_Leapmotor",
        "https://leapmotor--dev01.sandbox.my.site.com/ESWLPMLeapmotor1760706603231",
        {
          scrt2URL: "https://leapmotor--dev01.sandbox.my.salesforce-scrt.com",
        }
      );
    } catch (err) {
      console.error("Error loading Embedded Messaging:", err);
    }
  }
  /**
   * Extract country code from URL pathname
   * @returns {string} Country code (defaults to 'en')
   */
  function getCountryCodeFromPath() {
    const pathParts = window.location.pathname
      .split("/")
      .filter(function (part) {
        return part.length > 0;
      });
    return pathParts.length > 0 ? pathParts[0].toLowerCase() : "en";
  }
  /**
   * Get country information based on country code
   * @param {string} countryCode - Two-letter country code
   * @returns {Object} Country information object
   */
  function getCountryInfo(countryCode) {
    const COUNTRY_MAPPING = {
      it: { name: "Italy", language: "it", code: "it" },
      es: { name: "Spain", language: "es", code: "es" },
      fr: { name: "France", language: "fr", code: "fr" },
      de: { name: "Germany", language: "de", code: "de" },
      uk: { name: "United Kingdom", language: "en_US", code: "uk" },
      us: { name: "United States", language: "en_US", code: "us" },
      en: { name: "United States", language: "en_US", code: "en" },
    };
    return COUNTRY_MAPPING[countryCode] || COUNTRY_MAPPING["en"];
  }
  /**
   * Enhanced Custom Chat Button Module with Notifications
   * Handles creation and management of custom Leapmotor chat button with:
   * - Message count badges
   * - Inactivity detection
   * - Sound notifications
   * - Popup reminders
   */
  (function () {
    "use strict";
    // ============================================================================
    // CONSTANTS
    // ============================================================================
    const ELEMENT_IDS = {
      CIRCLE_BUTTON: 'chat-circle-btn',
      NOTIFICATION_BADGE: 'chat-notification-badge',
      NOTIFICATION_POPUP: 'chat-notification-popup',
      STYLES: 'leap-chat-styles'
    };
    const BREAKPOINTS = {
      MOBILE: 480,
      TABLET: 768,
    };
    const TIMING = {
      POLLING_INTERVAL: 200,
      MAX_POLLING_ATTEMPTS: 50,
      INACTIVITY_THRESHOLD: 5000,      // 5 seconds for inactivity prompt
      REMINDER_DELAY: 30000,            // 30 seconds for post-minimize reminder
      POPUP_DURATION: 5000              // 5 seconds popup display
    };
    
    const COLORS = {
      PRIMARY: '#64a028',               // Original green
      MAIN: '#2d5016',                  // Pantone 2427C
      HIGHLIGHT: '#009100',             // R0 G145 B0
      WHITE: '#ffffff',
      BADGE_RED: '#ff3b30'
    };
    
    const FONTS = {
      PRIMARY: "'Montserrat', 'Arial', sans-serif"
    };
    
    const SOUNDS = {
      NOTIFICATION: 'assets/notification.mp3',
      REMINDER: 'assets/reminder.mp3'
    };
    const LOCALIZATION = {
      MESSAGES: {
        it: "Chatta con me!",
        es: "¡Chatea conmigo!",
        fr: "Discutez avec moi!",
        de: "Chatte mit mir!",
        uk: "Chat with me!",
        us: "Chat with me!",
        en: "Chat with me!",
      },
      TOGGLE: {
        it: { open: "Massimizza", close: "Minimizza" },
        es: { open: "Maximizar", close: "Minimizar" },
        fr: { open: "Maximiser", close: "Minimiser" },
        de: { open: "Maximieren", close: "Minimieren" },
        uk: { open: "Maximize", close: "Minimize" },
        us: { open: "Maximize", close: "Minimize" },
        en: { open: "Maximize", close: "Minimize" },
      },
      PROMPTS: {
        it: "Hai bisogno di aiuto?",
        es: "¿Necesitas ayuda?",
        fr: "Besoin d'aide?",
        de: "Brauchst du Hilfe?",
        uk: "Need help?",
        us: "Need help?",
        en: "Need help?",
      },
    };
    // ============================================================================
    // STATE
    // ============================================================================
    const state = {
      chatClicked: false,
      embeddedServiceInstance: null,
      countryCode: getCountryCodeFromPath(),
      localization: null,
      // Notification state
      unreadCount: 0,
      lastActivityTime: Date.now(),
      inactivityTimer: null,
      reminderTimer: null,
      hasShownInactivityPrompt: false,
      isChatMinimized: false,
      isChatOpen: false,
      soundsLoaded: false
    };
    
    // Initialize localization
    state.localization = {
      message: LOCALIZATION.MESSAGES[state.countryCode] || LOCALIZATION.MESSAGES['en'],
      prompt: LOCALIZATION.PROMPTS[state.countryCode] || LOCALIZATION.PROMPTS['en']
    };
    console.log(
      "Detected country:",
      state.countryCode,
      "| Message:",
      state.localization.message
    );
    // Load unread count from sessionStorage
    try {
      const stored = sessionStorage.getItem("leap_chat_unread");
      if (stored) {
        state.unreadCount = parseInt(stored, 10) || 0;
      }
    } catch (e) {
      console.warn("Could not load unread count from sessionStorage:", e);
    }
    // ============================================================================
    // UTILITY FUNCTIONS
    // ============================================================================
    /**
     * Calculate 10% higher position
     * @param {string} bottomValue - Original bottom value (e.g., '12px')
     * @returns {string} New bottom value 10% higher
     */
    function calculateHigherPosition(bottomValue) {
      const numericValue = parseFloat(bottomValue);
      const viewportHeight = window.innerHeight;
      const additionalOffset = viewportHeight * 0.1;
      return numericValue + additionalOffset + "px";
    }
    /**
     * Get circle button position (below toggle button)
     * @returns {Object} Position object with right and bottom values
     */
    function getCircleButtonPosition() {
      const width = window.innerWidth;
      const positions = {
        mobile: { right: "17px", bottom: "12px" },
        tablet: { right: "21px", bottom: "16px" },
        desktop: { right: "25px", bottom: "24px" },
      };
      let position;
      if (width <= BREAKPOINTS.MOBILE) position = positions.mobile;
      else if (width <= BREAKPOINTS.TABLET) position = positions.tablet;
      else position = positions.desktop;
      return {
        right: position.right,
        bottom: calculateHigherPosition(position.bottom),
      };
    }
    /**
     * Apply multiple styles to an element
     * @param {HTMLElement} element - Target element
     * @param {Object} styles - Styles object
     */
    function applyStyles(element, styles) {
      Object.keys(styles).forEach(function (key) {
        element.style[key] = styles[key];
      });
    }
    /**
     * Save unread count to sessionStorage
     */
    function saveUnreadCount() {
      try {
        sessionStorage.setItem(
          "leap_chat_unread",
          state.unreadCount.toString()
        );
      } catch (e) {
        console.warn("Could not save unread count to sessionStorage:", e);
      }
    }
    // ============================================================================
    // SOUND MANAGEMENT
    // ============================================================================
    const soundManager = {
      sounds: {},
      /**
       * Preload sound files
       */
      init: function () {
        this.sounds.notification = new Audio(SOUNDS.NOTIFICATION);
        this.sounds.reminder = new Audio(SOUNDS.REMINDER);
        this.sounds.notification.volume = 0.5;
        this.sounds.reminder.volume = 0.5;
        // Preload
        this.sounds.notification.load();
        this.sounds.reminder.load();
        state.soundsLoaded = true;
        console.log("Sound files preloaded");
      },
      /**
       * Play notification sound
       */
      playNotification: function () {
        if (!state.soundsLoaded) return;
        try {
          this.sounds.notification.currentTime = 0;
          this.sounds.notification.play().catch(function (err) {
            console.warn("Could not play notification sound:", err);
          });
        } catch (e) {
          console.warn("Error playing notification sound:", e);
        }
      },
      /**
       * Play reminder sound
       */
      playReminder: function () {
        if (!state.soundsLoaded) return;
        try {
          this.sounds.reminder.currentTime = 0;
          this.sounds.reminder.play().catch(function (err) {
            console.warn("Could not play reminder sound:", err);
          });
        } catch (e) {
          console.warn("Error playing reminder sound:", e);
        }
      },
    };
    // ============================================================================
    // NOTIFICATION BADGE
    // ============================================================================
    /**
     * Create notification badge element
     * @returns {HTMLElement} Badge element
     */
    function createNotificationBadge() {
      const badge = document.createElement("div");
      badge.id = ELEMENT_IDS.NOTIFICATION_BADGE;
      badge.setAttribute("aria-label", "Unread messages");
      applyStyles(badge, {
        position: "absolute",
        top: "-5px",
        right: "-5px",
        minWidth: "24px",
        height: "24px",
        borderRadius: "12px",
        backgroundColor: COLORS.BADGE_RED,
        color: COLORS.WHITE,
        fontSize: "12px",
        fontWeight: "700",
        fontFamily: FONTS.PRIMARY,
        display: "none",
        alignItems: "center",
        justifyContent: "center",
        padding: "0 6px",
        boxShadow: "0 2px 8px rgba(0,0,0,0.3)",
        zIndex: "100000",
        border: "2px solid white",
      });
      return badge;
    }
    /**
     * Update notification badge
     */
    function updateNotificationBadge() {
      const badge = document.getElementById(ELEMENT_IDS.NOTIFICATION_BADGE);
      if (!badge) return;
      if (state.unreadCount > 0 && state.isChatMinimized) {
        badge.textContent =
          state.unreadCount > 9 ? "9+" : state.unreadCount.toString();
        badge.style.display = "flex";
      } else {
        badge.style.display = "none";
      }
    }
    /**
     * Increment unread count
     */
    function incrementUnreadCount() {
      state.unreadCount++;
      saveUnreadCount();
      updateNotificationBadge();
      console.log("Unread count:", state.unreadCount);
    }
    /**
     * Clear unread count
     */
    function clearUnreadCount() {
      state.unreadCount = 0;
      saveUnreadCount();
      updateNotificationBadge();
      console.log("Unread count cleared");
    }
    // ============================================================================
    // NOTIFICATION POPUP
    // ============================================================================
    /**
     * Create notification popup
     * @param {string} message - Message to display
     * @returns {HTMLElement} Popup element
     */
    function createNotificationPopup(message) {
      const popup = document.createElement("div");
      popup.id = ELEMENT_IDS.NOTIFICATION_POPUP;
      const position = getCircleButtonPosition();
      const bottomPos = parseFloat(position.bottom) + 90; // Position above button
      applyStyles(popup, {
        position: "fixed",
        right: position.right,
        bottom: bottomPos + "px",
        zIndex: "99998",
        backgroundColor: "rgba(255, 255, 255, 0.95)",
        backdropFilter: "blur(10px)",
        borderRadius: "16px",
        padding: "16px 20px",
        boxShadow: "0 8px 32px rgba(0,0,0,0.2)",
        border: "1px solid rgba(255,255,255,0.3)",
        maxWidth: "280px",
        opacity: "0",
        transform: "translateY(10px)",
        transition: "all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",
        cursor: "pointer",
        fontFamily: FONTS.PRIMARY,
      });
      // Message text
      const messageText = document.createElement("div");
      messageText.textContent = message;
      applyStyles(messageText, {
        fontSize: "16px",
        fontWeight: "600",
        color: COLORS.MAIN,
        marginBottom: "8px",
        textAlign: "center",
      });
      // Subtext
      const subtext = document.createElement("div");
      subtext.textContent = state.localization.message;
      applyStyles(subtext, {
        fontSize: "14px",
        color: COLORS.HIGHLIGHT,
        textAlign: "center",
        fontWeight: "500",
      });
      popup.appendChild(messageText);
      popup.appendChild(subtext);
      // Click to dismiss
      popup.addEventListener("click", function () {
        dismissNotificationPopup();
      });
      return popup;
    }
    /**
     * Show notification popup
     * @param {string} message - Message to display
     * @param {boolean} playSound - Whether to play sound
     */
    function showNotificationPopup(message, playSound) {
      // Remove existing popup
      dismissNotificationPopup();
      const popup = createNotificationPopup(message);
      document.body.appendChild(popup);
      // Trigger animation
      setTimeout(function () {
        popup.style.opacity = "1";
        popup.style.transform = "translateY(0)";
      }, 10);
      // Play sound
      if (playSound) {
        soundManager.playNotification();
      }
      // Auto-dismiss after duration
      setTimeout(function () {
        dismissNotificationPopup();
      }, TIMING.POPUP_DURATION);
      console.log("Notification popup shown:", message);
    }
    /**
     * Dismiss notification popup
     */
    function dismissNotificationPopup() {
      const popup = document.getElementById(ELEMENT_IDS.NOTIFICATION_POPUP);
      if (!popup) return;
      popup.style.opacity = "0";
      popup.style.transform = "translateY(10px)";
      setTimeout(function () {
        if (popup.parentNode) {
          popup.parentNode.removeChild(popup);
        }
      }, 300);
    }
    // ============================================================================
    // INACTIVITY DETECTION
    // ============================================================================
    /**
     * Reset activity timer
     */
    function resetActivityTimer() {
      state.lastActivityTime = Date.now();
      state.hasShownInactivityPrompt = false;
      // Clear existing timer
      if (state.inactivityTimer) {
        clearTimeout(state.inactivityTimer);
      }
      // Don't start timer if chat is open
      if (state.isChatOpen) return;
      // Start new timer
      state.inactivityTimer = setTimeout(function () {
        if (!state.hasShownInactivityPrompt && !state.isChatOpen) {
          showNotificationPopup(state.localization.prompt, true);
          state.hasShownInactivityPrompt = true;
        }
      }, TIMING.INACTIVITY_THRESHOLD);
    }
    /**
     * Track user activity
     */
    function trackActivity() {
      resetActivityTimer();
    }
    /**
     * Initialize activity tracking
     */
    function initActivityTracking() {
      const events = ["mousemove", "click", "scroll", "keypress", "touchstart"];
      events.forEach(function (eventName) {
        window.addEventListener(eventName, trackActivity, { passive: true });
      });
      // Start initial timer
      resetActivityTimer();
      console.log("Activity tracking initialized");
    }
    // ============================================================================
    // REMINDER TIMER
    // ============================================================================
    /**
     * Start reminder timer (30 seconds after minimize)
     */
    function startReminderTimer() {
      // Clear existing timer
      if (state.reminderTimer) {
        clearTimeout(state.reminderTimer);
      }
      state.reminderTimer = setTimeout(function () {
        if (
          state.isChatMinimized &&
          !state.isChatOpen &&
          state.unreadCount > 0
        ) {
          showNotificationPopup(state.localization.prompt, true);
          soundManager.playReminder();
          console.log("Reminder shown after 30 seconds");
        }
      }, TIMING.REMINDER_DELAY);
    }
    /**
     * Clear reminder timer
     */
    function clearReminderTimer() {
      if (state.reminderTimer) {
        clearTimeout(state.reminderTimer);
        state.reminderTimer = null;
      }
    }
    // ============================================================================
    // STYLES
    // ============================================================================
    /**
     * Create and append stylesheet to document head
     */
    function injectStyles() {
      if (document.getElementById(ELEMENT_IDS.STYLES)) return;
      const style = document.createElement("style");
      style.id = ELEMENT_IDS.STYLES;
      style.textContent = `
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
        
        @keyframes circlePulse {
          0%, 100% { 
            transform: scale(1); 
            box-shadow: 0 8px 24px rgba(0,0,0,0.3), 0 0 30px rgba(100, 160, 40, 0.4); 
          }
          50% { 
            transform: scale(1.05); 
            box-shadow: 0 8px 24px rgba(0,0,0,0.3), 0 0 40px rgba(100, 160, 40, 0.6); 
          }
        }
        
        @keyframes badgePulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.1); }
        }
        
        #${ELEMENT_IDS.CIRCLE_BUTTON} {
          animation: circlePulse 2s ease-in-out infinite;
        }
        
        #${ELEMENT_IDS.CIRCLE_BUTTON}:hover {
          transform: scale(1.1) !important;
          box-shadow: 0 8px 24px rgba(0,0,0,0.4), 0 0 50px rgba(100, 160, 40, 0.7) !important;
        }
        
        #${ELEMENT_IDS.NOTIFICATION_BADGE} {
          animation: badgePulse 1s ease-in-out infinite;
        }
      `;
      document.head.appendChild(style);
    }
    /**
     * Hide the standard Salesforce chat button
     * @param {Object} es - Embedded service instance
     */
    function hideStandardButton(es) {
      if (
        !es ||
        !es.utilAPI ||
        typeof es.utilAPI.hideChatButton !== "function"
      ) {
        return;
      }
      try {
        es.utilAPI.hideChatButton();
        console.log("Standard chat button hidden");
      } catch (error) {
        console.warn("Error hiding standard chat button:", error);
      }
    }
    /**
     * Launch the chat window
     */
    function launchChat() {
      if (!state.embeddedServiceInstance || 
          !state.embeddedServiceInstance.utilAPI ||
          typeof state.embeddedServiceInstance.utilAPI.launchChat !== 'function') {
        console.warn('launchChat() not available');
        return;
      }
      
      state.chatClicked = true;
      state.isChatOpen = true;
      state.isChatMinimized = false;
      
      // Clear notifications
      clearUnreadCount();
      clearReminderTimer();
      dismissNotificationPopup();
      
      console.log('Launching chat from circle button...');
      
      const result = state.embeddedServiceInstance.utilAPI.launchChat();
      
      if (result && typeof result.then === 'function') {
        result
          .then(function() {
            console.log('Chat launched successfully');
          })
          .catch(function(error) {
            console.error('Error launching chat:', error);
          });
      }
    }
    // ============================================================================
    // CHAT ICON
    // ============================================================================
    
    /**
     * Create modern chat icon for circle button
     * @returns {HTMLElement} Configured chat icon element
     */
    function createChatIcon() {
      const iconContainer = document.createElement('div');
      iconContainer.innerHTML = `
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 2H4C2.9 2 2.01 2.9 2.01 4L2 22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" fill="white" opacity="0.95"/>
          <circle cx="7" cy="10" r="1.5" fill="${COLORS.PRIMARY}">
            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0s"/>
          </circle>
          <circle cx="12" cy="10" r="1.5" fill="${COLORS.PRIMARY}">
            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0.2s"/>
          </circle>
          <circle cx="17" cy="10" r="1.5" fill="${COLORS.PRIMARY}">
            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0.4s"/>
          </circle>
        </svg>
      `;
      
      applyStyles(iconContainer, {
        width: '100%',
        height: '100%',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center'
      });
      
      return iconContainer;
    }
    // ============================================================================
    // BUTTON CREATION
    // ============================================================================
    
    /**
     * Create the circular chat button
     * @returns {HTMLButtonElement} Configured circular button
     */
    function createCircleButton() {
      const btn = document.createElement('button');
      btn.id = ELEMENT_IDS.CIRCLE_BUTTON;
      btn.setAttribute('aria-label', 'Open chat');
      
      const position = getCircleButtonPosition();
      
      applyStyles(btn, {
        position: 'fixed',
        right: position.right,
        bottom: position.bottom,
        zIndex: '99999',
        width: '70px',
        height: '70px',
        borderRadius: '50%',
        border: 'none',
        cursor: 'pointer',
        boxShadow: '0 8px 24px rgba(0,0,0,0.25), 0 4px 12px rgba(100, 160, 40, 0.3)',
        background: 'linear-gradient(135deg, ' + COLORS.PRIMARY + ' 0%, #7bc043 100%)',
        color: COLORS.WHITE,
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        padding: '0',
        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
        overflow: 'visible',
        fontFamily: FONTS.PRIMARY
      });
      
      // Create chat icon
      const chatIcon = createChatIcon();
      btn.appendChild(chatIcon);
      
      // Create and append notification badge
      const badge = createNotificationBadge();
      btn.appendChild(badge);
      
      // Add event listeners
      btn.addEventListener('click', function() {
        launchChat();
      });
      btn.addEventListener('mouseenter', function() {
        btn.style.transform = 'scale(1.1)';
        btn.style.boxShadow = '0 12px 32px rgba(0,0,0,0.3), 0 6px 16px rgba(100, 160, 40, 0.5)';
      });
      btn.addEventListener('mouseleave', function() {
        btn.style.transform = 'scale(1)';
        btn.style.boxShadow = '0 8px 24px rgba(0,0,0,0.25), 0 4px 12px rgba(100, 160, 40, 0.3)';
      });
      
      return btn;
    }
    // ============================================================================
    // BUTTON VISIBILITY MANAGEMENT
    // ============================================================================
    /**
     * Show the custom chat button
     * @param {Object} es - Embedded service instance
     */
    function showCustomCTA(es) {
      if (!es || !es.utilAPI) {
        console.warn('utilAPI not available');
        return;
      }
      
      // Check if button already exists
      const existing = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
      if (existing) {
        existing.style.display = 'flex';
        hideStandardButton(es);
        updateNotificationBadge();
        console.log('Custom circle button shown again');
        return;
      }
      
      // Inject styles
      injectStyles();
      
      // Create and append circle button
      const circleButton = createCircleButton();
      document.body.appendChild(circleButton);
      
      // Store instance and hide standard button
      state.embeddedServiceInstance = es;
      hideStandardButton(es);
      
      // Update badge if there are unread messages
      updateNotificationBadge();
      
      console.log('Custom circle button created with notifications');
    }
    /**
     * Hide the custom chat button
     */
    function hideCustomCTA() {
      const circleBtn = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
      if (circleBtn) {
        circleBtn.style.display = 'none';
      }
      
      dismissNotificationPopup();
    }
    // ============================================================================
    // SALESFORCE EVENT HANDLERS
    // ============================================================================
    /**
     * Handle button created event
     */
    function handleButtonCreated() {
      console.log("onEmbeddedMessagingButtonCreated fired");
      const es = window.embeddedservice_bootstrap;
      if (es) {
        showCustomCTA(es);
      }
    }
    /**
     * Handle window maximized event
     */
    function handleWindowMaximized() {
      console.log("onEmbeddedMessagingWindowMaximized fired");
      state.isChatOpen = true;
      state.isChatMinimized = false;
      hideCustomCTA();
      clearUnreadCount();
      clearReminderTimer();
      dismissNotificationPopup();
    }
    /**
     * Handle window minimized event
     */
    function handleWindowMinimized() {
      console.log('onEmbeddedMessagingWindowMinimized fired');
      state.isChatOpen = false;
      state.isChatMinimized = true;
      
      const es = window.embeddedservice_bootstrap;
      if (es) {
        hideStandardButton(es);
        
        // Show circle button
        const circleBtn = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
        if (circleBtn) {
          circleBtn.style.display = 'flex';
        }
        
        updateNotificationBadge();
        
        // Start reminder timer
        startReminderTimer();
      }
    }
    /**
     * Handle message received event
     */
    function handleMessageReceived(event) {
      console.log("onEmbeddedMessagingMessageReceived fired", event);
      // Only count messages when chat is minimized
      if (state.isChatMinimized && !state.isChatOpen) {
        incrementUnreadCount();
        soundManager.playNotification();
        // Restart reminder timer
        startReminderTimer();
      }
    }
    // ============================================================================
    // INITIALIZATION
    // ============================================================================
    /**
     * Poll for embedded service availability
     */
    function waitForEmbeddedService() {
      let attempts = 0;
      (function check() {
        attempts++;
        const es = window.embeddedservice_bootstrap;
        if (es && es.utilAPI) {
          console.log("utilAPI ready");
          showCustomCTA(es);
          return;
        }
        if (attempts >= TIMING.MAX_POLLING_ATTEMPTS) {
          console.warn("utilAPI not found after " + attempts + " attempts");
          return;
        }
        setTimeout(check, TIMING.POLLING_INTERVAL);
      })();
    }
    /**
     * Initialize the custom chat button
     */
    function init() {
      // Register Salesforce event listeners
      window.addEventListener(
        "onEmbeddedMessagingButtonCreated",
        handleButtonCreated
      );
      window.addEventListener(
        "onEmbeddedMessagingWindowMaximized",
        handleWindowMaximized
      );
      window.addEventListener(
        "onEmbeddedMessagingWindowMinimized",
        handleWindowMinimized
      );
      window.addEventListener(
        "onEmbeddedMessagingMessageReceived",
        handleMessageReceived
      );
      // Initialize sound manager
      soundManager.init();
      // Initialize activity tracking
      initActivityTracking();
      // Start polling for embedded service
      if (
        document.readyState === "complete" ||
        document.readyState === "interactive"
      ) {
        waitForEmbeddedService();
      } else {
        window.addEventListener("DOMContentLoaded", waitForEmbeddedService);
      }
      console.log("Enhanced chat button module initialized");
    }
    // Start initialization
    init();
  })();
</script>
<script
  type="text/javascript"
  src="https://leapmotor--dev01.sandbox.my.site.com/ESWLPMLeapmotor1760706603231/assets/js/bootstrap.min.js"
  onload="initEmbeddedMessaging()"
></script>

</body>
</html>
